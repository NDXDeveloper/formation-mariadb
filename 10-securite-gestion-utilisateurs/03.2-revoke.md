üîù Retour au [Sommaire](/SOMMAIRE.md)

# 10.3.2 REVOKE : R√©vocation de privil√®ges

> **Niveau** : Avanc√©
> **Dur√©e estim√©e** : 1.5 heures
> **Pr√©requis** : Section 10.3.1 (GRANT : Attribution de privil√®ges)

## üéØ Objectifs d'apprentissage

√Ä l'issue de cette section, vous serez capable de :
- Ma√Ætriser la syntaxe compl√®te de la commande REVOKE
- R√©voquer des privil√®ges √† tous les niveaux (global, base, table, colonne, routine)
- G√©rer les d√©pendances de privil√®ges et l'option GRANT OPTION
- Mettre en ≈ìuvre des proc√©dures s√©curis√©es de r√©vocation en production
- Auditer et r√©soudre les probl√®mes li√©s aux r√©vocations de privil√®ges

---

## Introduction

La commande `REVOKE` est le pendant de `GRANT` : elle retire des privil√®ges pr√©c√©demment accord√©s √† des utilisateurs ou des r√¥les. Une gestion rigoureuse des r√©vocations est essentielle pour maintenir la s√©curit√© du syst√®me, notamment lors de d√©parts d'employ√©s, changements de responsabilit√©s ou incidents de s√©curit√©.

La r√©vocation de privil√®ges suit le principe de **defense in depth** : m√™me si un compte est d√©sactiv√©, ses privil√®ges doivent √™tre r√©voqu√©s explicitement pour √©viter toute r√©activation accidentelle.

‚ö†Ô∏è **Attention** : La r√©vocation de privil√®ges peut avoir des impacts critiques sur les applications en production. Testez toujours dans un environnement de staging et planifiez soigneusement les r√©vocations.

---

## Syntaxe g√©n√©rale de REVOKE

### Syntaxe de base

```sql
-- R√©vocation de privil√®ges
REVOKE privilege_type [(column_list)]
    [, privilege_type [(column_list)]] ...
    ON [object_type] privilege_level
    FROM user_or_role [, user_or_role] ...;

-- R√©vocation de GRANT OPTION
REVOKE GRANT OPTION ON privilege_level
    FROM user_or_role [, user_or_role] ...;

-- R√©vocation de tous les privil√®ges
REVOKE ALL PRIVILEGES, GRANT OPTION
    FROM user_or_role [, user_or_role] ...;
```

### Diff√©rences syntaxiques avec GRANT

| Aspect | GRANT | REVOKE |
|--------|-------|--------|
| Pr√©position | `TO user` | `FROM user` |
| Options | `WITH GRANT OPTION` | Pas d'options |
| Quotas | Peut d√©finir MAX_* | Ne peut pas modifier |
| Cascade | Non applicable | Pas de cascade automatique |

---

## R√©vocation par niveau de privil√®ge

### 1. Niveau Global (*.*)

Retrait de privil√®ges globaux (tous les serveurs).

```sql
-- R√©voquer des privil√®ges administratifs
REVOKE SUPER, RELOAD, PROCESS
    ON *.*
    FROM 'former_dba'@'localhost';

-- R√©voquer l'acc√®s en lecture globale
REVOKE SELECT
    ON *.*
    FROM 'readonly_global'@'%';

-- R√©voquer tous les privil√®ges globaux
REVOKE ALL PRIVILEGES
    ON *.*
    FROM 'ex_admin'@'%';
```

üí° **Conseil** : Apr√®s r√©vocation de privil√®ges globaux, v√©rifiez que l'utilisateur n'a pas de privil√®ges √©quivalents au niveau base ou table.

### 2. Niveau Base de donn√©es (database.*)

```sql
-- R√©voquer l'acc√®s √† une base sp√©cifique
REVOKE ALL PRIVILEGES
    ON production_db.*
    FROM 'developer'@'%';

-- R√©voquer des privil√®ges sp√©cifiques
REVOKE INSERT, UPDATE, DELETE
    ON app_db.*
    FROM 'readonly_app'@'%';
-- L'utilisateur conserve SELECT si accord√©

-- R√©voquer uniquement certains privil√®ges DDL
REVOKE ALTER, DROP
    ON dev_db.*
    FROM 'junior_dev'@'%';
```

### 3. Niveau Table (database.table)

```sql
-- R√©voquer l'acc√®s √† une table sensible
REVOKE ALL PRIVILEGES
    ON hr_db.salaries
    FROM 'contractor'@'%';

-- R√©voquer la modification mais conserver la lecture
REVOKE INSERT, UPDATE, DELETE
    ON orders_db.orders
    FROM 'sales_viewer'@'%';

-- R√©voquer l'acc√®s en √©criture
REVOKE INSERT, UPDATE, DELETE
    ON audit_db.audit_log
    FROM 'app_user'@'%';
```

### 4. Niveau Colonne

```sql
-- R√©voquer l'acc√®s √† des colonnes sensibles
REVOKE SELECT (salary, bonus)
    ON hr_db.employees
    FROM 'hr_viewer'@'%';

-- R√©voquer la modification de colonnes sp√©cifiques
REVOKE UPDATE (performance_rating)
    ON hr_db.employees
    FROM 'former_manager'@'%';
```

‚ö†Ô∏è **Attention** : Si un utilisateur a un privil√®ge SELECT global ou au niveau base, la r√©vocation au niveau colonne n'aura aucun effet. Vous devez d'abord r√©voquer le privil√®ge de niveau sup√©rieur.

### 5. Niveau Routine (proc√©dures et fonctions)

```sql
-- R√©voquer l'ex√©cution d'une proc√©dure
REVOKE EXECUTE
    ON PROCEDURE sales_db.calculate_commission
    FROM 'ex_sales_app'@'%';

-- R√©voquer toutes les ex√©cutions de routines
REVOKE EXECUTE
    ON sales_db.*
    FROM 'reporting_user'@'%';

-- Fonction sp√©cifique
REVOKE EXECUTE
    ON FUNCTION analytics.compute_metrics
    FROM 'dashboard_app'@'10.20.30.%';
```

---

## R√©vocation de GRANT OPTION

L'option `GRANT OPTION` permet √† un utilisateur de d√©l√©guer ses privil√®ges. Sa r√©vocation est critique pour emp√™cher la propagation non contr√¥l√©e de privil√®ges.

### R√©vocation de GRANT OPTION seul

```sql
-- R√©voquer uniquement la capacit√© de d√©l√©gation
REVOKE GRANT OPTION
    ON app_db.*
    FROM 'db_admin'@'%';

-- L'utilisateur conserve ses privil√®ges mais ne peut plus les d√©l√©guer
SHOW GRANTS FOR 'db_admin'@'%';
-- R√©sultat : GRANT SELECT, INSERT, UPDATE ON `app_db`.* TO `db_admin`@`%`
-- (Plus de WITH GRANT OPTION)
```

### R√©vocation de privil√®ges ET GRANT OPTION

```sql
-- R√©voquer √† la fois les privil√®ges et la d√©l√©gation
REVOKE ALL PRIVILEGES, GRANT OPTION
    ON app_db.*
    FROM 'former_admin'@'%';
```

### Comportement en cascade (limitations)

‚ö†Ô∏è **Important** : MariaDB ne r√©voque **PAS automatiquement** les privil√®ges qui ont √©t√© d√©l√©gu√©s par un utilisateur dont on r√©voque GRANT OPTION.

```sql
-- Sc√©nario probl√©matique :
-- 1. admin_user a GRANT OPTION
GRANT SELECT ON db.* TO 'admin_user'@'%' WITH GRANT OPTION;

-- 2. admin_user d√©l√®gue √† d'autres
-- (connect√© en tant que admin_user)
GRANT SELECT ON db.* TO 'user1'@'%';
GRANT SELECT ON db.* TO 'user2'@'%';

-- 3. R√©vocation de GRANT OPTION de admin_user
REVOKE GRANT OPTION ON db.* FROM 'admin_user'@'%';

-- Probl√®me : user1 et user2 conservent leurs privil√®ges !
-- Solution : Audit et r√©vocation manuelle
REVOKE SELECT ON db.* FROM 'user1'@'%';
REVOKE SELECT ON db.* FROM 'user2'@'%';
```

üí° **Solution** : Maintenez un journal d'audit des GRANT effectu√©s ou utilisez un script pour d√©tecter les cha√Ænes de d√©l√©gation avant r√©vocation.

---

## R√©vocation totale des privil√®ges

### M√©thode 1 : REVOKE ALL (recommand√©e)

```sql
-- R√©voquer tous les privil√®ges sur toutes les bases
REVOKE ALL PRIVILEGES, GRANT OPTION
    ON *.*
    FROM 'ex_employee'@'%';

-- V√©rifier qu'il ne reste rien
SHOW GRANTS FOR 'ex_employee'@'%';
-- R√©sultat attendu : GRANT USAGE ON *.* TO `ex_employee`@`%`
-- (USAGE = aucun privil√®ge)
```

### M√©thode 2 : R√©vocation base par base

```sql
-- Lister toutes les bases o√π l'utilisateur a des privil√®ges
SELECT DISTINCT db
FROM mysql.db
WHERE user = 'username' AND host = '%';

-- R√©voquer pour chaque base
REVOKE ALL PRIVILEGES ON db1.* FROM 'username'@'%';
REVOKE ALL PRIVILEGES ON db2.* FROM 'username'@'%';
REVOKE ALL PRIVILEGES ON db3.* FROM 'username'@'%';
```

### M√©thode 3 : Script automatis√©

```sql
-- G√©n√©rer les commandes REVOKE automatiquement
SELECT CONCAT('REVOKE ALL PRIVILEGES ON `', db, '`.* FROM ''',
              user, '''@''', host, ''';') AS revoke_statement
FROM mysql.db
WHERE user = 'target_user'
UNION
SELECT CONCAT('REVOKE ALL PRIVILEGES, GRANT OPTION ON *.* FROM ''',
              user, '''@''', host, ''';')
FROM mysql.user
WHERE user = 'target_user';

-- Copier-coller les r√©sultats pour ex√©cution
```

---

## Cas d'usage en production

### Cas 1 : D√©part d'un employ√©

```sql
-- Proc√©dure compl√®te de r√©vocation
-- 1. Identifier tous les privil√®ges
SHOW GRANTS FOR 'john.doe'@'%';

-- 2. R√©voquer GRANT OPTION en premier
REVOKE GRANT OPTION ON *.* FROM 'john.doe'@'%';

-- 3. R√©voquer tous les privil√®ges
REVOKE ALL PRIVILEGES ON *.* FROM 'john.doe'@'%';

-- 4. V√©rifier les privil√®ges d√©l√©gu√©s (si applicable)
SELECT CONCAT('REVOKE ALL PRIVILEGES ON `', db, '`.* FROM ''',
              user, '''@''', host, ''';')
FROM mysql.db
WHERE user IN (
    -- Liste des utilisateurs potentiellement cr√©√©s par john.doe
    SELECT DISTINCT user FROM mysql.user
    WHERE host LIKE '%john%' OR user LIKE '%john%'
);

-- 5. Verrouiller le compte (ne pas supprimer imm√©diatement)
ALTER USER 'john.doe'@'%' ACCOUNT LOCK;

-- 6. Apr√®s validation (30-90 jours), supprimer
DROP USER 'john.doe'@'%';
```

üí° **Meilleure pratique** : Ne supprimez jamais un utilisateur imm√©diatement. Verrouillez-le d'abord (`ACCOUNT LOCK`) pour permettre une p√©riode de transition et d√©tecter les d√©pendances.

### Cas 2 : D√©gradation de privil√®ges (principe du moindre privil√®ge)

```sql
-- Analyste qui n'a plus besoin de modifier les donn√©es
-- Avant : SELECT, INSERT, UPDATE, DELETE
SHOW GRANTS FOR 'analyst'@'%';

-- R√©voquer les privil√®ges d'√©criture
REVOKE INSERT, UPDATE, DELETE
    ON analytics_db.*
    FROM 'analyst'@'%';

-- V√©rifier
SHOW GRANTS FOR 'analyst'@'%';
-- R√©sultat attendu : GRANT SELECT ON `analytics_db`.* TO `analyst`@`%`
```

### Cas 3 : R√©duction de p√©rim√®tre

```sql
-- D√©veloppeur qui change de projet
-- Avant : acc√®s √† project_a et project_b
-- Apr√®s : acc√®s uniquement √† project_b

-- R√©voquer acc√®s √† l'ancien projet
REVOKE ALL PRIVILEGES
    ON project_a_db.*
    FROM 'developer'@'%';

-- Conserver acc√®s au nouveau projet (d√©j√† accord√©)
SHOW GRANTS FOR 'developer'@'%';
-- GRANT SELECT, INSERT, UPDATE, DELETE ON `project_b_db`.* TO `developer`@`%`
```

### Cas 4 : Incident de s√©curit√©

```sql
-- R√©vocation d'urgence en cas de compromission
-- 1. Identifier le compte compromis
SET @compromised_user = 'suspicious_app';
SET @compromised_host = '192.168.1.50';

-- 2. Verrouiller imm√©diatement
SET @sql = CONCAT('ALTER USER ''', @compromised_user, '''@''',
                  @compromised_host, ''' ACCOUNT LOCK');
PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

-- 3. Terminer toutes les connexions actives
SELECT CONCAT('KILL ', id, ';') AS kill_command
FROM information_schema.processlist
WHERE user = @compromised_user
  AND host LIKE CONCAT(@compromised_host, '%');

-- 4. R√©voquer tous les privil√®ges
SET @sql = CONCAT('REVOKE ALL PRIVILEGES, GRANT OPTION ON *.* FROM ''',
                  @compromised_user, '''@''', @compromised_host, '''');
PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

-- 5. Auditer les actions r√©centes (binary log, audit log)
-- 6. Cr√©er un nouveau compte avec credentials s√©curis√©s
```

### Cas 5 : R√©vocation temporaire (maintenance)

```sql
-- Bloquer temporairement l'acc√®s pendant une maintenance
-- Option 1 : ACCOUNT LOCK (pr√©f√©r√©)
ALTER USER 'app_user'@'%' ACCOUNT LOCK;

-- Option 2 : R√©vocation + sauvegarde des privil√®ges
CREATE TABLE tmp_privileges AS
SELECT * FROM mysql.db WHERE user = 'app_user';

REVOKE ALL PRIVILEGES ON app_db.* FROM 'app_user'@'%';

-- Apr√®s maintenance : restaurer
-- (re-GRANT manuellement ou via script)
GRANT SELECT, INSERT, UPDATE, DELETE ON app_db.* TO 'app_user'@'%';

-- Nettoyer
DROP TABLE tmp_privileges;
```

üí° **Recommandation** : Utilisez `ACCOUNT LOCK` plut√¥t que REVOKE pour les blocages temporaires, c'est plus rapide et r√©versible.

---

## V√©rification apr√®s r√©vocation

### 1. V√©rifier les privil√®ges restants

```sql
-- Afficher les privil√®ges actuels
SHOW GRANTS FOR 'username'@'hostname';

-- V√©rifier l'absence de privil√®ges globaux
SELECT user, host, Select_priv, Insert_priv, Update_priv,
       Delete_priv, Grant_priv
FROM mysql.user
WHERE user = 'username' AND host = 'hostname';

-- V√©rifier l'absence de privil√®ges de base
SELECT * FROM mysql.db
WHERE user = 'username' AND host = 'hostname';
```

### 2. Tester l'acc√®s

```sql
-- Se connecter avec le compte modifi√©
-- mysql -u username -p -h hostname

-- Tester une op√©ration qui devrait √©chouer
USE restricted_db;  -- Devrait √©chouer : ERROR 1044
SELECT * FROM restricted_table;  -- Devrait √©chouer : ERROR 1142
```

### 3. Audit des connexions actives

```sql
-- V√©rifier qu'aucune session active n'utilise encore d'anciens privil√®ges
SELECT id, user, host, db, command, time, state, info
FROM information_schema.processlist
WHERE user = 'username';

-- Terminer si n√©cessaire
KILL CONNECTION <id>;
```

---

## Gestion des d√©pendances

### Identifier les objets d√©pendants

```sql
-- Vues qui d√©pendent des privil√®ges d'un utilisateur
SELECT table_schema, table_name, definer
FROM information_schema.views
WHERE definer = 'username@hostname';

-- Proc√©dures stock√©es
SELECT routine_schema, routine_name, definer, security_type
FROM information_schema.routines
WHERE definer = 'username@hostname';

-- Triggers
SELECT trigger_schema, trigger_name, definer
FROM information_schema.triggers
WHERE definer = 'username@hostname';

-- Events
SELECT event_schema, event_name, definer
FROM information_schema.events
WHERE definer = 'username@hostname';
```

‚ö†Ô∏è **Attention** : Les objets d√©finis par un utilisateur (vues, proc√©dures, triggers, events) peuvent cesser de fonctionner apr√®s r√©vocation de ses privil√®ges, m√™me si ces objets ont `SQL SECURITY DEFINER`.

### Solution : Changer le DEFINER

```sql
-- Changer le DEFINER d'une vue
ALTER DEFINER = 'new_admin'@'localhost'
    SQL SECURITY DEFINER
    VIEW mydb.myview AS SELECT * FROM mytable;

-- Changer le DEFINER d'une proc√©dure
ALTER DEFINER = 'new_admin'@'localhost'
    SQL SECURITY DEFINER
    PROCEDURE mydb.my_procedure(...) ...;
```

---

## R√©vocation et r√¥les (MariaDB 10.0.5+)

### R√©voquer un r√¥le d'un utilisateur

```sql
-- Cr√©er un r√¥le avec privil√®ges
CREATE ROLE app_writer;
GRANT SELECT, INSERT, UPDATE, DELETE ON app_db.* TO app_writer;

-- Attribuer le r√¥le
GRANT app_writer TO 'user1'@'%';

-- R√©voquer le r√¥le
REVOKE app_writer FROM 'user1'@'%';
```

### R√©voquer des privil√®ges d'un r√¥le

```sql
-- Le r√¥le app_writer a trop de privil√®ges
-- R√©voquer UPDATE et DELETE
REVOKE UPDATE, DELETE ON app_db.* FROM app_writer;

-- Tous les utilisateurs ayant ce r√¥le perdent ces privil√®ges
```

### Supprimer un r√¥le compl√®tement

```sql
-- 1. R√©voquer le r√¥le de tous les utilisateurs
SELECT CONCAT('REVOKE ', role, ' FROM ''', user, '''@''', host, ''';')
FROM mysql.roles_mapping
WHERE role = 'app_writer';

-- Ex√©cuter les commandes g√©n√©r√©es

-- 2. Supprimer le r√¥le
DROP ROLE app_writer;
```

---

## Bonnes pratiques de r√©vocation

### 1. Principe de pr√©caution

```sql
-- ‚úÖ BON : Planifier et documenter
-- Script de r√©vocation avec backup
START TRANSACTION;  -- Pas applicable aux DCL, mais pour documenter l'intention

-- Sauvegarder les privil√®ges actuels
CREATE TABLE backup_grants_20251213 AS
SELECT * FROM mysql.db WHERE user = 'target_user';

-- R√©voquer
REVOKE ALL PRIVILEGES ON app_db.* FROM 'target_user'@'%';

-- COMMIT (conceptuel pour la documentation)
```

### 2. Tester en staging d'abord

```sql
-- ‚úÖ BON : Tester sur une r√©plique ou un environnement de test
-- 1. Sur staging
REVOKE INSERT, UPDATE, DELETE ON app_db.* FROM 'app_user'@'%';

-- 2. Tester l'application
-- 3. Si OK, appliquer en production
```

### 3. R√©vocation progressive

```sql
-- ‚úÖ BON : R√©voquer progressivement pour limiter l'impact
-- √âtape 1 : R√©voquer DELETE (moins critique)
REVOKE DELETE ON app_db.* FROM 'user'@'%';
-- Monitorer 24h

-- √âtape 2 : R√©voquer UPDATE
REVOKE UPDATE ON app_db.* FROM 'user'@'%';
-- Monitorer 24h

-- √âtape 3 : R√©voquer INSERT
REVOKE INSERT ON app_db.* FROM 'user'@'%';
```

### 4. Coordination avec les √©quipes

```sql
-- ‚úÖ BON : Notification et coordination
-- 1. Notifier les √©quipes impact√©es (7 jours avant)
-- 2. Planifier pendant une fen√™tre de maintenance
-- 3. Pr√©parer un plan de rollback

-- Plan de rollback (exemple)
-- GRANT SELECT, INSERT, UPDATE, DELETE ON app_db.* TO 'user'@'%';
```

### 5. Audit et tra√ßabilit√©

```sql
-- ‚úÖ BON : Logger toutes les r√©vocations
-- Cr√©er une table d'audit
CREATE TABLE IF NOT EXISTS security_audit.privilege_revocations (
    revocation_id INT AUTO_INCREMENT PRIMARY KEY,
    revoked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    revoked_by VARCHAR(100),
    target_user VARCHAR(100),
    target_host VARCHAR(100),
    privilege_type VARCHAR(50),
    privilege_level VARCHAR(200),
    reason TEXT,
    ticket_number VARCHAR(50)
);

-- Enregistrer chaque r√©vocation
INSERT INTO security_audit.privilege_revocations
(revoked_by, target_user, target_host, privilege_type, privilege_level, reason, ticket_number)
VALUES
(CURRENT_USER(), 'ex_employee', '%', 'ALL PRIVILEGES', '*.*',
 'Employee departure', 'SEC-2025-001');

-- Ex√©cuter la r√©vocation
REVOKE ALL PRIVILEGES, GRANT OPTION ON *.* FROM 'ex_employee'@'%';
```

### 6. Automatisation avec scripts

```bash
#!/bin/bash
# Script de r√©vocation s√©curis√©e

USER="$1"
HOST="$2"
REASON="$3"

# Validation
if [ -z "$USER" ] || [ -z "$HOST" ] || [ -z "$REASON" ]; then
    echo "Usage: $0 <user> <host> <reason>"
    exit 1
fi

# Confirmation
echo "About to revoke all privileges from '$USER'@'$HOST'"
echo "Reason: $REASON"
read -p "Continue? (yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "Aborted."
    exit 0
fi

# Backup des privil√®ges
mysql -e "SELECT * FROM mysql.db WHERE user='$USER' AND host='$HOST'" > "backup_${USER}_${HOST}_$(date +%Y%m%d).sql"

# R√©vocation
mysql -e "REVOKE ALL PRIVILEGES, GRANT OPTION ON *.* FROM '$USER'@'$HOST';"
mysql -e "ALTER USER '$USER'@'$HOST' ACCOUNT LOCK;"

echo "Privileges revoked and account locked for '$USER'@'$HOST'"
echo "Backup saved to backup_${USER}_${HOST}_$(date +%Y%m%d).sql"
```

---

## Erreurs courantes et r√©solution

### Erreur 1 : "There is no such grant defined"

```sql
-- Erreur
REVOKE SELECT ON db.* FROM 'user'@'host';
-- ERROR 1141 (42000): There is no such grant defined for user 'user' on host 'host'

-- Cause : Privil√®ge non accord√© ou host incorrect
-- Solution : V√©rifier les privil√®ges existants
SHOW GRANTS FOR 'user'@'host';

-- Identifier le bon host
SELECT user, host FROM mysql.user WHERE user = 'user';
```

### Erreur 2 : Les privil√®ges persistent apr√®s REVOKE

```sql
-- Probl√®me : REVOKE ne semble pas fonctionner

-- Cause possible 1 : Privil√®ge √† un niveau sup√©rieur
REVOKE SELECT ON db.table FROM 'user'@'%';
-- Mais l'utilisateur a SELECT sur db.* ou *.*

-- Solution : R√©voquer au bon niveau
SHOW GRANTS FOR 'user'@'%';
REVOKE SELECT ON db.* FROM 'user'@'%';

-- Cause possible 2 : Cache de privil√®ges
FLUSH PRIVILEGES;  -- Force le rechargement (normalement automatique)
```

### Erreur 3 : R√©vocation partielle inefficace

```sql
-- Probl√®me : R√©voquer SELECT sur certaines colonnes n'a aucun effet

-- Cause : Privil√®ge SELECT au niveau table ou sup√©rieur
SELECT * FROM mysql.tables_priv WHERE user = 'username';
SELECT * FROM mysql.db WHERE user = 'username';

-- Solution : R√©voquer le privil√®ge global, puis re-GRANT colonne par colonne
REVOKE SELECT ON db.table FROM 'user'@'%';
GRANT SELECT (col1, col2) ON db.table TO 'user'@'%';
```

### Erreur 4 : "Access denied" apr√®s r√©vocation de GRANT OPTION

```sql
-- Probl√®me : Utilisateur ne peut plus se connecter apr√®s r√©vocation

-- Cause : Confusion entre REVOKE GRANT OPTION et REVOKE ALL
-- REVOKE GRANT OPTION retire uniquement la d√©l√©gation, pas les privil√®ges

-- Solution : V√©rifier les privil√®ges restants
SHOW GRANTS FOR 'user'@'%';

-- Si tous les privil√®ges ont √©t√© r√©voqu√©s par erreur, les restaurer
GRANT SELECT, INSERT, UPDATE, DELETE ON db.* TO 'user'@'%';
```

---

## Diff√©rences avec MySQL

| Fonctionnalit√© | MariaDB 11.8 | MySQL 8.0 |
|----------------|--------------|-----------|
| Syntaxe REVOKE | Identique | Identique |
| R√©vocation de r√¥les | ‚úÖ Depuis 10.0.5 | ‚úÖ Depuis 8.0 |
| Cascade automatique | ‚ùå Non | ‚ùå Non |
| REVOKE IF EXISTS | ‚ùå Non support√© | ‚ùå Non support√© |
| ACCOUNT LOCK | ‚úÖ Recommand√© | ‚úÖ Recommand√© |

---

## ‚úÖ Points cl√©s √† retenir

- **REVOKE** retire des privil√®ges √† tous les niveaux : global, base, table, colonne, routine
- **Pas de cascade automatique** : les privil√®ges d√©l√©gu√©s via GRANT OPTION ne sont pas r√©voqu√©s automatiquement
- **R√©vocation de GRANT OPTION** en premier pour emp√™cher la propagation de privil√®ges
- **REVOKE ALL PRIVILEGES** retire tous les privil√®ges mais laisse le compte actif (USAGE)
- **ALTER USER ... ACCOUNT LOCK** est pr√©f√©rable √† REVOKE pour les blocages temporaires
- **Testez toujours en staging** avant de r√©voquer en production
- **Auditez les d√©pendances** (vues, proc√©dures, triggers) avant r√©vocation
- **Documentez et tracez** toutes les r√©vocations pour la conformit√© et le troubleshooting

---

## üîó Ressources et r√©f√©rences

- [üìñ Documentation officielle MariaDB - REVOKE](https://mariadb.com/kb/en/revoke/)
- [üìñ Account Management SQL Commands](https://mariadb.com/kb/en/account-management-sql-commands/)
- [üìñ Privilege System Overview](https://mariadb.com/kb/en/grant/#privilege-levels)
- [üìñ ALTER USER - ACCOUNT LOCK](https://mariadb.com/kb/en/alter-user/#account-lock)
- [Blog : Best Practices for Revoking Database Privileges](https://mariadb.org/revoking-privileges-safely/)

---

## ‚û°Ô∏è Section suivante

**10.3.3 [Privil√®ges globaux, base, table, colonne](/10-securite-gestion-utilisateurs/03.3-niveaux-privileges.md)** : Approfondissez la hi√©rarchie des privil√®ges, comprenez les r√®gles de pr√©c√©dence et optimisez votre mod√®le de s√©curit√©.

‚è≠Ô∏è [Privil√®ges globaux, base, table, colonne](/10-securite-gestion-utilisateurs/03.3-niveaux-privileges.md)
