üîù Retour au [Sommaire](/SOMMAIRE.md)

# 16.5.2 D√©ploiement Galera avec operator

> **Niveau** : Expert  
> **Dur√©e estim√©e** : 4-5 heures  
> **Pr√©requis** : Kubernetes avanc√©, StatefulSets, Operators, MariaDB Galera concepts, section 16.4.1

## üéØ Objectifs d'apprentissage

√Ä l'issue de cette section, vous serez capable de :
- D√©ployer un cluster MariaDB Galera hautement disponible sur Kubernetes
- Utiliser mariadb-operator pour g√©rer le cycle de vie de Galera
- Configurer le bootstrap automatique et la r√©cup√©ration d'un cluster
- G√©rer les state transfers (SST/IST) en environnement Kubernetes
- Impl√©menter le monitoring et l'observabilit√© du cluster
- G√©rer les op√©rations de scaling et de maintenance
- Appliquer les meilleures pratiques pour la production

---

## Introduction

MariaDB Galera Cluster est une solution de r√©plication synchrone multi-master qui offre une haute disponibilit√© et une scalabilit√© en lecture/√©criture. Le d√©ploiement sur Kubernetes avec un operator simplifie consid√©rablement la gestion de cette architecture complexe.

### Galera vs R√©plication traditionnelle

| Caract√©ristique | Galera Cluster | R√©plication Master-Slave |
|-----------------|----------------|--------------------------|
| **Type** | Synchrone multi-master | Asynchrone master-slave |
| **√âcriture** | Tous les n≈ìuds | Master uniquement |
| **Lecture** | Tous les n≈ìuds | Master + Slaves |
| **Coh√©rence** | Forte (certification) | √âventuelle |
| **Failover** | Automatique | Manuel ou avec outil |
| **Complexit√©** | √âlev√©e | Moyenne |
| **Latence** | Plus √©lev√©e | Plus faible |

### Pourquoi un Operator Kubernetes ?

**Avantages de l'operator pattern** :
- ‚úÖ **Automatisation** : Bootstrap, scaling, backup, recovery
- ‚úÖ **Self-healing** : D√©tection et r√©cup√©ration automatiques
- ‚úÖ **Declarative** : Configuration via CRDs (Custom Resource Definitions)
- ‚úÖ **Observabilit√©** : M√©triques et √©v√©nements Kubernetes natifs
- ‚úÖ **Maintenance** : Rolling updates, upgrades automatis√©s
- ‚úÖ **Backup/Restore** : Int√©gration native avec storage backends

**MariaDB Operators disponibles** :
- [mariadb-operator](https://github.com/mariadb-operator/mariadb-operator) - Open source, communautaire
- MariaDB Enterprise Operator - Version commerciale avec support
- Bitnami MariaDB Galera Helm Chart - Solution Helm alternative

üí° **Conseil** : Nous utiliserons mariadb-operator (open source) dans cette section.

---

## Architecture Galera sur Kubernetes

### Composants de l'architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Kubernetes Cluster                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                 mariadb-operator                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Controller Manager                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Webhook Server                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                          ‚îÇ                                  ‚îÇ
‚îÇ                          ‚ñº                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ               MariaDB CRD (Custom Resource)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Galera configuration                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Replicas: 3                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Storage: PVC                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Backup schedule                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                          ‚îÇ                                  ‚îÇ
‚îÇ                          ‚ñº                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ              StatefulSet (MariaDB Galera)            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Pod 0       ‚îÇ  ‚îÇ Pod 1       ‚îÇ  ‚îÇ Pod 2       ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ mariadb-0   ‚îÇ  ‚îÇ mariadb-1   ‚îÇ  ‚îÇ mariadb-2   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ             ‚îÇ  ‚îÇ             ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ PVC-0       ‚îÇ  ‚îÇ PVC-1       ‚îÇ  ‚îÇ PVC-2       ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ        ‚îÇ                 ‚îÇ                 ‚îÇ         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                  Galera Replication                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                          ‚îÇ                                  ‚îÇ
‚îÇ                          ‚ñº                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ                    Services                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Headless Service (internal)                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Primary Service (read-write)                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Secondary Service (read-only)                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Flux de d√©ploiement

1. **Installation de l'operator** : D√©ploiement du controller et des CRDs
2. **Cr√©ation de la MariaDB CR** : D√©finition du cluster d√©sir√©
3. **Provisioning du StatefulSet** : L'operator cr√©e les ressources Kubernetes
4. **Bootstrap du cluster** : Le premier pod initialise Galera
5. **Joining des n≈ìuds** : Les autres pods rejoignent le cluster
6. **Service discovery** : Configuration des services pour acc√®s applicatif
7. **Monitoring** : M√©triques et healthchecks automatiques

---

## Installation de mariadb-operator

### Pr√©requis

```bash
# V√©rifier la version Kubernetes (>= 1.25)
kubectl version --short

# Installer cert-manager (requis pour webhooks)
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml

# V√©rifier cert-manager
kubectl get pods -n cert-manager
```

### Installation via Helm

```bash
# Ajouter le repository Helm
helm repo add mariadb-operator https://mariadb-operator.github.io/mariadb-operator
helm repo update

# Installer l'operator
helm install mariadb-operator mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --create-namespace \
  --version 0.27.0

# V√©rifier l'installation
kubectl get pods -n mariadb-system
kubectl get crd | grep mariadb
```

### Installation via manifests

```bash
# T√©l√©charger les CRDs
kubectl apply -f https://github.com/mariadb-operator/mariadb-operator/releases/latest/download/crds.yaml

# Installer l'operator
kubectl apply -f https://github.com/mariadb-operator/mariadb-operator/releases/latest/download/operator.yaml

# V√©rifier
kubectl get deployment -n mariadb-system mariadb-operator
```

### V√©rification de l'installation

```bash
# Lister les CRDs install√©es
kubectl get crd | grep mariadb

# Output attendu:
# backups.k8s.mariadb.com
# connections.k8s.mariadb.com
# databases.k8s.mariadb.com
# grants.k8s.mariadb.com
# mariadbs.k8s.mariadb.com
# restores.k8s.mariadb.com
# sqljobs.k8s.mariadb.com
# users.k8s.mariadb.com

# V√©rifier les logs de l'operator
kubectl logs -n mariadb-system -l app.kubernetes.io/name=mariadb-operator -f
```

---

## Configuration de base Galera avec CRD

### MariaDB CR pour Galera Cluster

```yaml
# galera-cluster.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb-galera
  namespace: production
spec:
  # üÜï MariaDB 11.8 LTS
  image: mariadb:11.8.1
  imagePullPolicy: IfNotPresent
  
  # Root credentials (utiliser Secret en production)
  rootPasswordSecretKeyRef:
    name: mariadb-root-password
    key: password
  
  # Configuration Galera
  galera:
    enabled: true
    primary:
      # Mode de r√©cup√©ration du primary
      podIndex: 0
      automaticFailover: true
    
    # SST (State Snapshot Transfer) method
    sst: mariabackup
    
    # Configuration r√©plication
    replicaThreads: 4
    
    # Galera provider options
    providerOptions:
      gcache.size: 1G
      gcache.page_size: 512M
    
    # Recovery settings
    recovery:
      enabled: true
      minClusterSize: 2
      clusterBootstrapTimeout: 10m
      clusterHealthyTimeout: 30s
      podRecoveryTimeout: 5m
      podSyncTimeout: 5m
  
  # Nombre de replicas
  replicas: 3
  
  # Storage
  storage:
    size: 100Gi
    storageClassName: ssd-retain
    resizeInUseVolumes: true
    waitForVolumeResize: true
  
  # Resources
  resources:
    requests:
      cpu: "2"
      memory: 4Gi
    limits:
      cpu: "4"
      memory: 8Gi
  
  # üÜï MariaDB 11.8 - Configuration personnalis√©e
  myCnf: |
    [mariadb]
    # Character set (utf8mb4 par d√©faut en 11.8)
    character-set-server = utf8mb4
    collation-server = utf8mb4_unicode_ci
    
    # InnoDB Configuration
    innodb_buffer_pool_size = 3G
    innodb_log_file_size = 512M
    innodb_flush_method = O_DIRECT
    innodb_flush_log_at_trx_commit = 2
    
    # üÜï MariaDB 11.8 - Optimisations
    innodb_io_capacity = 2000
    innodb_io_capacity_max = 4000
    innodb_alter_copy_bulk = 256M
    
    # Connection settings
    max_connections = 500
    
    # Binary logs (for backup)
    log_bin = mariadb-bin
    binlog_format = ROW
    expire_logs_days = 7
    
    # Slow query log
    slow_query_log = 1
    long_query_time = 2
    
    # üÜï MariaDB 11.8 - Temp space control
    max_tmp_space_usage = 10G
    
    # Galera settings
    wsrep_on = ON
    wsrep_provider_options = "gcache.size=1G"
    wsrep_slave_threads = 4
    
    # Cluster address (g√©r√© par l'operator)
    # wsrep_cluster_address automatiquement configur√©
  
  # Services
  service:
    type: ClusterIP
    annotations:
      service.alpha.kubernetes.io/tolerate-unready-endpoints: "true"
  
  # Primary service (read-write)
  primaryService:
    type: ClusterIP
    annotations: {}
  
  # Secondary service (read-only)
  secondaryService:
    type: ClusterIP
    annotations: {}
  
  # Metrics
  metrics:
    enabled: true
    exporter:
      image: prom/mysqld-exporter:latest
      port: 9104
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 100m
          memory: 128Mi
    
    serviceMonitor:
      enabled: true
      prometheusRelease: prometheus
      interval: 30s
      scrapeTimeout: 10s
  
  # Affinity (spread across nodes)
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                  - mariadb-galera
          topologyKey: kubernetes.io/hostname
  
  # Tolerations
  tolerations:
    - key: "database"
      operator: "Equal"
      value: "mariadb"
      effect: "NoSchedule"
  
  # Pod Disruption Budget
  podDisruptionBudget:
    maxUnavailable: 1
  
  # Update strategy
  updateStrategy:
    type: RollingUpdate
  
  # Liveness probe
  livenessProbe:
    exec:
      command:
        - bash
        - -c
        - mariadb -u root -p"${MARIADB_ROOT_PASSWORD}" -e "SELECT 1"
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  # Readiness probe
  readinessProbe:
    exec:
      command:
        - bash
        - -c
        - |
          mariadb -u root -p"${MARIADB_ROOT_PASSWORD}" -e "
          SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS 
          WHERE VARIABLE_NAME='wsrep_ready';" | grep -q "ON"
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
```

### Secret pour mot de passe root

```yaml
# mariadb-root-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: mariadb-root-password
  namespace: production
type: Opaque
stringData:
  password: "SuperSecureRootPassword123!"
```

### StorageClass SSD avec r√©tention

```yaml
# storageclass-ssd-retain.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ssd-retain
provisioner: kubernetes.io/aws-ebs  # Adapter selon votre cloud
parameters:
  type: gp3
  iops: "3000"
  throughput: "125"
  fsType: ext4
reclaimPolicy: Retain
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
```

### D√©ploiement

```bash
# Cr√©er le namespace
kubectl create namespace production

# Appliquer le secret
kubectl apply -f mariadb-root-secret.yaml

# Appliquer la StorageClass
kubectl apply -f storageclass-ssd-retain.yaml

# D√©ployer le cluster Galera
kubectl apply -f galera-cluster.yaml

# Surveiller le d√©ploiement
kubectl get mariadb -n production -w

# V√©rifier les pods
kubectl get pods -n production -l app.kubernetes.io/instance=mariadb-galera

# V√©rifier les PVCs
kubectl get pvc -n production
```

---

## Gestion du Bootstrap et du Cluster

### Bootstrap initial

Le bootstrap est g√©r√© automatiquement par l'operator :

```bash
# V√©rifier l'√©tat du bootstrap
kubectl get mariadb mariadb-galera -n production -o yaml | grep -A 10 galeraConfig

# Logs du pod primaire (bootstrap)
kubectl logs -n production mariadb-galera-0 -c mariadb -f

# V√©rifier que Galera est actif
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "SHOW STATUS LIKE 'wsrep%';"
```

### V√©rification de l'√©tat du cluster

```bash
# Status du cluster depuis n'importe quel pod
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SELECT VARIABLE_NAME, VARIABLE_VALUE 
  FROM information_schema.GLOBAL_STATUS 
  WHERE VARIABLE_NAME IN (
    'wsrep_cluster_size',
    'wsrep_cluster_status',
    'wsrep_connected',
    'wsrep_ready',
    'wsrep_local_state_comment'
  );"

# Output attendu :
# wsrep_cluster_size: 3
# wsrep_cluster_status: Primary
# wsrep_connected: ON
# wsrep_ready: ON
# wsrep_local_state_comment: Synced
```

### Script de monitoring Galera

```bash
#!/bin/bash
# galera-status.sh

NAMESPACE="production"
MARIADB_NAME="mariadb-galera"
ROOT_PASSWORD=$(kubectl get secret mariadb-root-password -n $NAMESPACE -o jsonpath='{.data.password}' | base64 -d)

echo "=== Galera Cluster Status ==="
echo

for pod in $(kubectl get pods -n $NAMESPACE -l app.kubernetes.io/instance=$MARIADB_NAME -o name); do
    echo "--- ${pod} ---"
    kubectl exec -n $NAMESPACE ${pod#pod/} -- mariadb -uroot -p"${ROOT_PASSWORD}" -e "
    SELECT 
        VARIABLE_VALUE as 'Node',
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='wsrep_cluster_size') as 'Cluster Size',
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='wsrep_local_state_comment') as 'State',
        (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME='wsrep_ready') as 'Ready'
    FROM information_schema.GLOBAL_STATUS 
    WHERE VARIABLE_NAME='wsrep_node_name';
    " 2>/dev/null
    echo
done
```

---

## State Snapshot Transfer (SST)

### Configuration SST avec mariabackup

L'operator configure automatiquement SST avec mariabackup (recommand√©) :

```yaml
spec:
  galera:
    sst: mariabackup  # ou rsync, mysqldump
    
    # Configuration SST avanc√©e
    providerOptions:
      # Gcache (cache de r√©plication)
      gcache.size: 1G
      gcache.page_size: 512M
      
      # IST (Incremental State Transfer) threshold
      # Si le lag est inf√©rieur, utiliser IST au lieu de SST
      ist.recv_addr: auto
```

### Types de transfert

**SST (Full State Snapshot Transfer)** :
- Transfert complet des donn√©es
- Utilis√© pour nouveau n≈ìud ou n≈ìud tr√®s d√©synchronis√©
- M√©thodes : mariabackup (recommand√©), rsync, mysqldump

**IST (Incremental State Transfer)** :
- Transfert incr√©mental via gcache
- Utilis√© quand le n≈ìud a seulement rat√© quelques transactions
- Plus rapide que SST

### Monitoring SST/IST

```bash
# V√©rifier le type de transfert en cours
kubectl exec -n production mariadb-galera-1 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_local_state_comment';"

# Surveiller la progression SST
kubectl logs -n production mariadb-galera-1 -c mariadb -f | grep -i sst

# V√©rifier gcache
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_local_cached_downto';"
```

---

## Configuration avanc√©e

### Configuration avec ConfigMap

```yaml
# mariadb-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: mariadb-galera-config
  namespace: production
data:
  custom.cnf: |
    [mariadb]
    # üÜï MariaDB 11.8 - Character set
    character-set-server = utf8mb4
    collation-server = utf8mb4_unicode_ci
    
    # InnoDB optimizations
    innodb_buffer_pool_size = 4G
    innodb_buffer_pool_instances = 4
    innodb_log_file_size = 512M
    innodb_flush_method = O_DIRECT
    innodb_flush_log_at_trx_commit = 2
    
    # üÜï MariaDB 11.8 features
    innodb_io_capacity = 2000
    innodb_io_capacity_max = 4000
    innodb_alter_copy_bulk = 256M
    max_tmp_space_usage = 10G
    
    # Galera performance
    wsrep_slave_threads = 8
    wsrep_retry_autocommit = 3
    wsrep_provider_options = "gcache.size=2G;gcache.page_size=512M"
    
    # Connection pooling
    max_connections = 1000
    thread_cache_size = 128
    table_open_cache = 4096
    
    # Query cache (disabled in 11.x)
    query_cache_type = 0
    query_cache_size = 0
    
    # Logging
    slow_query_log = 1
    slow_query_log_file = /var/log/mysql/slow.log
    long_query_time = 2
    log_queries_not_using_indexes = 0
```

```yaml
# R√©f√©rencer le ConfigMap dans la MariaDB CR
spec:
  myCnfConfigMapKeyRef:
    name: mariadb-galera-config
    key: custom.cnf
```

### Init container pour configuration

```yaml
spec:
  podTemplate:
    initContainers:
      - name: init-config
        image: busybox:latest
        command:
          - sh
          - -c
          - |
            echo "Initializing configuration..."
            # Copier des fichiers de configuration
            cp /config/custom.cnf /etc/mysql/conf.d/
            chmod 644 /etc/mysql/conf.d/custom.cnf
        volumeMounts:
          - name: config
            mountPath: /config
          - name: conf
            mountPath: /etc/mysql/conf.d
```

---

## Scaling du cluster

### Scale-out (ajouter des n≈ìuds)

```bash
# Passer de 3 √† 5 replicas
kubectl patch mariadb mariadb-galera -n production \
  --type='json' \
  -p='[{"op": "replace", "path": "/spec/replicas", "value": 5}]'

# V√©rifier le scaling
kubectl get pods -n production -l app.kubernetes.io/instance=mariadb-galera -w

# V√©rifier que les nouveaux n≈ìuds ont rejoint le cluster
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_cluster_size';"
```

### Scale-in (retirer des n≈ìuds)

```bash
# ‚ö†Ô∏è Toujours faire un scale-in progressif
# Passer de 5 √† 4, puis 4 √† 3

kubectl patch mariadb mariadb-galera -n production \
  --type='json' \
  -p='[{"op": "replace", "path": "/spec/replicas", "value": 4}]'

# Attendre que le pod soit supprim√© proprement
kubectl wait --for=delete pod/mariadb-galera-4 -n production --timeout=300s

# Continuer si n√©cessaire
kubectl patch mariadb mariadb-galera -n production \
  --type='json' \
  -p='[{"op": "replace", "path": "/spec/replicas", "value": 3}]'
```

‚ö†Ô∏è **Attention** : Ne jamais descendre en dessous de 3 n≈ìuds en production pour maintenir le quorum.

---

## Backup et restauration

### Configuration du backup avec l'operator

```yaml
# backup-schedule.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: Backup
metadata:
  name: mariadb-galera-backup
  namespace: production
spec:
  # MariaDB source
  mariaDbRef:
    name: mariadb-galera
  
  # Schedule (cron format)
  schedule:
    cron: "0 2 * * *"  # Tous les jours √† 2h AM
    suspend: false
  
  # Backup method
  backupMethod: mariabackup
  
  # Storage configuration
  storage:
    # S3 backend
    s3:
      bucket: mariadb-backups
      endpoint: s3.eu-west-1.amazonaws.com
      region: eu-west-1
      prefix: galera/production
      
      # Credentials
      accessKeyIdSecretKeyRef:
        name: s3-credentials
        key: access-key-id
      secretAccessKeySecretKeyRef:
        name: s3-credentials
        key: secret-access-key
    
    # Ou PVC backend
    # persistentVolumeClaim:
    #   storageClassName: ssd-retain
    #   resources:
    #     requests:
    #       storage: 500Gi
  
  # Retention policy
  maxRetention: 30d
  
  # Resources
  resources:
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 4Gi
  
  # Affinity (ne pas ex√©cuter sur n≈ìud DB)
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/instance
                  operator: In
                  values:
                    - mariadb-galera
            topologyKey: kubernetes.io/hostname
```

### Secret pour S3

```yaml
# s3-credentials.yaml
apiVersion: v1
kind: Secret
metadata:
  name: s3-credentials
  namespace: production
type: Opaque
stringData:
  access-key-id: "AKIAIOSFODNN7EXAMPLE"
  secret-access-key: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
```

### Backup manuel

```yaml
# manual-backup.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: Backup
metadata:
  name: mariadb-galera-manual-backup
  namespace: production
spec:
  mariaDbRef:
    name: mariadb-galera
  
  backupMethod: mariabackup
  
  storage:
    s3:
      bucket: mariadb-backups
      endpoint: s3.eu-west-1.amazonaws.com
      region: eu-west-1
      prefix: galera/production/manual
      
      accessKeyIdSecretKeyRef:
        name: s3-credentials
        key: access-key-id
      secretAccessKeySecretKeyRef:
        name: s3-credentials
        key: secret-access-key
```

```bash
# D√©clencher un backup manuel
kubectl apply -f manual-backup.yaml

# Surveiller le backup
kubectl get backup -n production -w

# V√©rifier les logs
kubectl logs -n production -l job-name=mariadb-galera-manual-backup -f
```

### Restauration

```yaml
# restore.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: Restore
metadata:
  name: mariadb-galera-restore
  namespace: production
spec:
  # MariaDB target
  mariaDbRef:
    name: mariadb-galera
  
  # Backup source
  backupRef:
    name: mariadb-galera-backup-20251214
  
  # Ou S3 directement
  # s3:
  #   bucket: mariadb-backups
  #   prefix: galera/production/mariadb-galera-backup-20251214
  #   endpoint: s3.eu-west-1.amazonaws.com
  
  # Target restore time (PITR)
  targetRecoveryTime: "2025-12-14T10:00:00Z"
  
  # Resources
  resources:
    requests:
      cpu: "2"
      memory: 4Gi
    limits:
      cpu: "4"
      memory: 8Gi
```

```bash
# Ex√©cuter la restauration
kubectl apply -f restore.yaml

# Surveiller la restauration
kubectl get restore -n production -w

# V√©rifier les logs
kubectl logs -n production -l job-name=mariadb-galera-restore -f
```

---

## Monitoring et observabilit√©

### ServiceMonitor pour Prometheus

L'operator cr√©e automatiquement un ServiceMonitor si activ√© :

```yaml
spec:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      prometheusRelease: prometheus
      interval: 30s
      scrapeTimeout: 10s
      labels:
        prometheus: kube-prometheus
```

### M√©triques Galera personnalis√©es

```yaml
# galera-servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: mariadb-galera-metrics
  namespace: production
  labels:
    app: mariadb-galera
    prometheus: kube-prometheus
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: mariadb-galera
      app.kubernetes.io/component: metrics
  
  endpoints:
    - port: metrics
      interval: 30s
      scrapeTimeout: 10s
      path: /metrics
      
      # Relabeling pour ajouter des labels
      relabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: pod
        - sourceLabels: [__meta_kubernetes_pod_node_name]
          targetLabel: node
      
      metricRelabelings:
        # Garder uniquement les m√©triques Galera importantes
        - sourceLabels: [__name__]
          regex: 'mysql_global_status_wsrep.*'
          action: keep
```

### Alertes PrometheusRule

```yaml
# galera-alerts.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: mariadb-galera-alerts
  namespace: production
  labels:
    prometheus: kube-prometheus
spec:
  groups:
    - name: mariadb_galera
      interval: 30s
      rules:
        # Cluster non op√©rationnel
        - alert: GaleraClusterDown
          expr: mysql_global_status_wsrep_cluster_status != 1
          for: 5m
          labels:
            severity: critical
          annotations:
            summary: "Galera cluster {{ $labels.pod }} is not in Primary state"
            description: "Cluster status is not Primary. Current status: {{ $value }}"
        
        # N≈ìud non connect√©
        - alert: GaleraNodeNotConnected
          expr: mysql_global_status_wsrep_connected != 1
          for: 2m
          labels:
            severity: critical
          annotations:
            summary: "Galera node {{ $labels.pod }} is not connected"
            description: "Node has lost connection to the cluster"
        
        # N≈ìud pas pr√™t
        - alert: GaleraNodeNotReady
          expr: mysql_global_status_wsrep_ready != 1
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Galera node {{ $labels.pod }} is not ready"
            description: "Node is not ready to accept queries"
        
        # Taille du cluster incorrecte
        - alert: GaleraClusterSizeMismatch
          expr: mysql_global_status_wsrep_cluster_size < 3
          for: 5m
          labels:
            severity: critical
          annotations:
            summary: "Galera cluster size is {{ $value }}, expected 3"
            description: "One or more nodes are missing from the cluster"
        
        # Flow control actif (performance)
        - alert: GaleraFlowControlPaused
          expr: rate(mysql_global_status_wsrep_flow_control_paused[5m]) > 0.1
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "Galera flow control paused on {{ $labels.pod }}"
            description: "Node is pausing due to flow control ({{ $value | humanizePercentage }})"
        
        # Conflit de certification
        - alert: GaleraCertificationFailures
          expr: rate(mysql_global_status_wsrep_local_cert_failures[5m]) > 0
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Galera certification failures on {{ $labels.pod }}"
            description: "Cluster is experiencing certification conflicts ({{ $value }} failures/sec)"
```

### Dashboard Grafana

```json
{
  "dashboard": {
    "title": "MariaDB Galera Cluster",
    "panels": [
      {
        "title": "Cluster Size",
        "targets": [
          {
            "expr": "mysql_global_status_wsrep_cluster_size",
            "legendFormat": "{{ pod }}"
          }
        ]
      },
      {
        "title": "Cluster Status",
        "targets": [
          {
            "expr": "mysql_global_status_wsrep_cluster_status",
            "legendFormat": "{{ pod }}"
          }
        ]
      },
      {
        "title": "Node State",
        "targets": [
          {
            "expr": "mysql_global_status_wsrep_local_state",
            "legendFormat": "{{ pod }}"
          }
        ]
      },
      {
        "title": "Flow Control",
        "targets": [
          {
            "expr": "rate(mysql_global_status_wsrep_flow_control_paused[5m])",
            "legendFormat": "{{ pod }}"
          }
        ]
      }
    ]
  }
}
```

---

## Haute disponibilit√© et failover

### Configuration du failover automatique

```yaml
spec:
  galera:
    primary:
      podIndex: 0
      automaticFailover: true
    
    recovery:
      enabled: true
      minClusterSize: 2
      clusterBootstrapTimeout: 10m
```

### Test de failover

```bash
# Simuler la perte du n≈ìud primaire
kubectl delete pod mariadb-galera-0 -n production

# Observer le failover
kubectl get pods -n production -w

# V√©rifier le nouveau primary
kubectl exec -n production mariadb-galera-1 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_local_state_comment';"

# V√©rifier que le cluster est toujours op√©rationnel
kubectl exec -n production mariadb-galera-1 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SELECT @@wsrep_cluster_size, @@wsrep_cluster_status;"
```

### PodDisruptionBudget

```yaml
# D√©j√† configur√© dans la MariaDB CR
spec:
  podDisruptionBudget:
    maxUnavailable: 1
```

Cela garantit qu'au maximum 1 pod peut √™tre indisponible pendant les maintenances.

---

## Troubleshooting

### Probl√®mes courants

#### 1. Cluster ne d√©marre pas (split-brain)

```bash
# Identifier le n≈ìud avec la s√©quence la plus r√©cente
for pod in mariadb-galera-{0..2}; do
  echo "=== $pod ==="
  kubectl exec -n production $pod -- cat /var/lib/mysql/grastate.dat 2>/dev/null || echo "Not available"
done

# Forcer le bootstrap sur le n≈ìud appropri√©
kubectl patch mariadb mariadb-galera -n production \
  --type='json' \
  -p='[{
    "op": "replace",
    "path": "/spec/galera/recovery/forceClusterBootstrapInPod",
    "value": "mariadb-galera-1"
  }]'
```

#### 2. N≈ìud bloqu√© en √©tat "Joining"

```bash
# V√©rifier les logs du n≈ìud
kubectl logs -n production mariadb-galera-2 -c mariadb --tail=100

# V√©rifier l'√©tat SST
kubectl exec -n production mariadb-galera-2 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_local_state_comment';"

# Si bloqu√©, red√©marrer le pod
kubectl delete pod mariadb-galera-2 -n production
```

#### 3. Performance d√©grad√©e (flow control)

```bash
# V√©rifier le flow control
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_flow_control%';"

# Identifier le n≈ìud lent
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  SHOW STATUS LIKE 'wsrep_local_recv_queue%';"

# Solutions :
# - Augmenter wsrep_slave_threads
# - Optimiser les requ√™tes lentes
# - Augmenter les ressources du n≈ìud lent
```

#### 4. Corruption de donn√©es

```bash
# V√©rifier l'int√©grit√© des tables
kubectl exec -n production mariadb-galera-0 -- \
  mariadb -uroot -p"${ROOT_PASSWORD}" -e "
  CHECK TABLE your_database.your_table;"

# Si corruption d√©tect√©e, restaurer depuis backup
kubectl apply -f restore.yaml
```

### Logs et debugging

```bash
# Logs de l'operator
kubectl logs -n mariadb-system -l app.kubernetes.io/name=mariadb-operator -f

# Logs MariaDB
kubectl logs -n production mariadb-galera-0 -c mariadb --tail=100

# Events Kubernetes
kubectl get events -n production --sort-by='.lastTimestamp'

# Describe du StatefulSet
kubectl describe statefulset mariadb-galera -n production

# Status d√©taill√© de la MariaDB CR
kubectl describe mariadb mariadb-galera -n production
```

---

## Meilleures pratiques production

### 1. Dimensionnement

```yaml
# Recommandations production
spec:
  replicas: 3  # Minimum, 5 pour haute criticit√©
  
  resources:
    requests:
      cpu: "4"      # Minimum 2 cores par n≈ìud
      memory: 8Gi   # 75% pour innodb_buffer_pool
    limits:
      cpu: "8"
      memory: 16Gi
  
  storage:
    size: 500Gi     # Dimensionner pour 6-12 mois de croissance
    storageClassName: ssd-retain  # SSD obligatoire
```

### 2. Topologie et placement

```yaml
spec:
  # Anti-affinit√© stricte (diff√©rents n≈ìuds)
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/instance
                operator: In
                values:
                  - mariadb-galera
          topologyKey: kubernetes.io/hostname
  
  # Topology spread (diff√©rentes zones)
  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/instance: mariadb-galera
```

### 3. S√©curit√©

```yaml
spec:
  # TLS pour r√©plication Galera
  galera:
    ssl:
      enabled: true
      certificateSecretKeyRef:
        name: galera-tls
        key: tls.crt
      privateKeySecretKeyRef:
        name: galera-tls
        key: tls.key
      caSecretKeyRef:
        name: galera-tls
        key: ca.crt
  
  # Security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault
  
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true
```

### 4. Backup

```yaml
# Backup quotidien + r√©tention
spec:
  schedule:
    cron: "0 2 * * *"
  maxRetention: 30d
  
  # Backup incr√©mental horaire (si support√©)
  incrementalBackup:
    enabled: true
    schedule:
      cron: "0 * * * *"
```

### 5. Monitoring

- ‚úÖ ServiceMonitor activ√©
- ‚úÖ Alertes configur√©es
- ‚úÖ Dashboard Grafana
- ‚úÖ Logs centralis√©s (ELK/Loki)

---

## ‚úÖ Points cl√©s √† retenir

- **Operator** : Simplifie consid√©rablement la gestion de Galera sur K8s
- **Bootstrap** : G√©r√© automatiquement par l'operator avec recovery automatique
- **Quorum** : Toujours maintenir un nombre impair de n≈ìuds (3, 5, 7)
- **SST/IST** : mariabackup est la m√©thode SST recommand√©e
- **Anti-affinit√©** : Critique pour √©viter la perte de quorum
- **Monitoring** : Surveiller wsrep_cluster_size, wsrep_ready, flow_control
- **Backup** : Automatiser avec l'operator et tester les restaurations
- **Storage** : SSD obligatoire avec ReclaimPolicy Retain
- **Scaling** : Toujours progressif, jamais en dessous de 3 n≈ìuds
- **MariaDB 11.8** : Profitez des optimisations SSD et utf8mb4 natif

---

## üîó Ressources et r√©f√©rences

### Documentation officielle
- [üìñ mariadb-operator Documentation](https://github.com/mariadb-operator/mariadb-operator/tree/main/docs)
- [üìñ MariaDB Galera Documentation](https://mariadb.com/kb/en/galera-cluster/)
- [üìñ Galera Configuration](https://galeracluster.com/library/documentation/)
- [üìñ Kubernetes StatefulSets](https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/)

### Exemples et templates
- [mariadb-operator Examples](https://github.com/mariadb-operator/mariadb-operator/tree/main/examples)
- [Galera Best Practices](https://galeracluster.com/library/training/tutorials/galera-monitoring.html)

### Outils compl√©mentaires
- [Prometheus Operator](https://github.com/prometheus-operator/prometheus-operator)
- [Grafana Loki](https://grafana.com/oss/loki/) - Logs aggregation
- [Velero](https://velero.io/) - Kubernetes backup

---

## ‚û°Ô∏è Section suivante

**16.5.3 R√©plication avec operator** : D√©couvrez comment configurer la r√©plication Master-Slave traditionnelle avec mariadb-operator, incluant GTID, semi-synchronous replication et failover automatique.

---

**MariaDB** : 11.8 LTS

‚è≠Ô∏è [R√©plication avec operator](/16-devops-automatisation/05.3-replication-operator.md)
