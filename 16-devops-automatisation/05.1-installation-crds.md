üîù Retour au [Sommaire](/SOMMAIRE.md)

# 16.5.1 Installation et CRDs

> **Niveau** : Avanc√© √† Expert  
> **Dur√©e estim√©e** : 3-4 heures  
> **Pr√©requis** : Kubernetes administration, kubectl, Helm, MariaDB, sections 16.3.x

## üéØ Objectifs d'apprentissage

√Ä l'issue de cette section, vous serez capable de :
- Installer et configurer le MariaDB Operator sur Kubernetes
- Comprendre l'architecture et les composants de l'operator
- Ma√Ætriser les Custom Resource Definitions (CRDs) MariaDB
- D√©ployer des instances MariaDB via des manifests d√©claratifs
- Configurer RBAC et s√©curit√© pour l'operator
- Diagnostiquer et troubleshooter les d√©ploiements operator
- Appliquer les meilleures pratiques de production

---

## Introduction

Le **MariaDB Operator** est un operator Kubernetes qui automatise le d√©ploiement, la gestion et les op√©rations de MariaDB sur Kubernetes. Il impl√©mente le pattern Operator pour transformer MariaDB en service cloud-native, offrant des capacit√©s d'auto-healing, de scaling et de mise √† jour automatis√©es.

### Qu'est-ce qu'un Kubernetes Operator ?

Un Operator est un pattern Kubernetes qui √©tend les capacit√©s de l'API avec des **Custom Resource Definitions (CRDs)** et un **controller** qui impl√©mente la logique m√©tier sp√©cifique √† l'application.

**Composants cl√©s** :
- üîß **CRDs** : D√©finitions de ressources personnalis√©es (MariaDB, User, Backup, etc.)
- ‚öôÔ∏è **Controller** : Boucle de r√©conciliation qui observe et agit sur les ressources
- üìä **Webhooks** : Validation et mutation des ressources
- üîÑ **Reconciliation Loop** : √âtat d√©sir√© ‚Üí √âtat actuel

### Pourquoi utiliser le MariaDB Operator ?

**Avantages cl√©s** :
- ‚úÖ **D√©claratif** : Gestion via manifests YAML versionn√©s
- ‚úÖ **Automation** : D√©ploiement, scaling, backup automatis√©s
- ‚úÖ **Self-healing** : Red√©marrage automatique des pods d√©faillants
- ‚úÖ **GitOps ready** : Int√©gration parfaite avec ArgoCD/Flux
- ‚úÖ **High Availability** : R√©plication et Galera natifs
- ‚úÖ **Day-2 operations** : Backup, restore, upgrade simplifi√©s
- ‚úÖ **Kubernetes native** : Suit les patterns et best practices K8s

**Cas d'usage** :
- D√©ploiements MariaDB en production sur Kubernetes
- Architectures multi-tenant avec isolation par namespace
- CI/CD avec environnements √©ph√©m√®res
- Disaster recovery automatis√©
- Scaling horizontal et vertical

---

## Architecture du MariaDB Operator

### Vue d'ensemble

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Kubernetes Cluster                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ          MariaDB Operator Namespace                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  MariaDB Operator Deployment                 ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  Controller Manager Pod                ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  - CRD Controllers                     ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  - Reconciliation Loops                ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  - Webhooks (Validation/Mutation)      ‚îÇ  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Webhook Service                             ‚îÇ   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ          Application Namespace                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ MariaDB CR     ‚îÇ  ‚îÇ Backup CR      ‚îÇ             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (Custom        ‚îÇ  ‚îÇ (Custom        ‚îÇ             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Resource)     ‚îÇ  ‚îÇ  Resource)     ‚îÇ             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ          ‚îÇ                    ‚îÇ                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ          ‚ñº                    ‚ñº                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  MariaDB StatefulSet                       ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ Pod0 ‚îÇ  ‚îÇ Pod1 ‚îÇ  ‚îÇ Pod2 ‚îÇ              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ      ‚îÇ         ‚îÇ         ‚îÇ                 ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ      ‚ñº         ‚ñº         ‚ñº                 ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ PVC  ‚îÇ  ‚îÇ PVC  ‚îÇ  ‚îÇ PVC  ‚îÇ              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Services (Primary, Replica, Headless)     ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Composants de l'operator

| Composant | R√¥le | Type |
|-----------|------|------|
| **Controller Manager** | Boucle de r√©conciliation principale | Deployment |
| **CRD Controller** | G√®re les ressources MariaDB | Controller |
| **Webhook Server** | Validation et mutation des CRs | Service |
| **RBAC** | Permissions et ServiceAccounts | ClusterRole |
| **CRDs** | D√©finitions de ressources | CustomResourceDefinition |

---

## Pr√©requis

### Cluster Kubernetes

**Versions support√©es** :
- Kubernetes >= 1.25
- Helm >= 3.8
- kubectl configur√© et fonctionnel

```bash
# V√©rifier la version Kubernetes
kubectl version --short

# V√©rifier l'acc√®s au cluster
kubectl cluster-info

# V√©rifier les nodes
kubectl get nodes
```

### Storage

L'operator n√©cessite un **StorageClass** avec support des volumes persistants :

```bash
# Lister les StorageClasses disponibles
kubectl get storageclass

# Exemple de sortie :
# NAME                 PROVISIONER             RECLAIMPOLICY
# standard (default)   kubernetes.io/gce-pd    Delete
# ssd                  kubernetes.io/gce-pd    Retain
```

Si aucune StorageClass n'existe, en cr√©er une :

```yaml
# storageclass-local.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: mariadb-storage
provisioner: kubernetes.io/no-provisioner
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
```

### Namespace

```bash
# Cr√©er un namespace pour l'operator
kubectl create namespace mariadb-system

# Cr√©er un namespace pour les applications
kubectl create namespace mariadb-app
```

---

## Installation de l'operator

### M√©thode 1 : Installation avec Helm (Recommand√©)

```bash
# Ajouter le repository Helm
helm repo add mariadb-operator https://mariadb-operator.github.io/mariadb-operator
helm repo update

# Voir les valeurs disponibles
helm show values mariadb-operator/mariadb-operator > values.yaml

# Installer l'operator
helm install mariadb-operator \
  mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --create-namespace \
  --version 0.28.0

# V√©rifier l'installation
kubectl get pods -n mariadb-system
kubectl get crd | grep mariadb
```

#### Configuration Helm personnalis√©e

```yaml
# values-custom.yaml
# Configuration avanc√©e pour production

# Image de l'operator
image:
  repository: ghcr.io/mariadb-operator/mariadb-operator
  tag: "v0.28.0"
  pullPolicy: IfNotPresent

# Replicas pour HA
replicaCount: 3

# Resources
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Affinity pour distribution sur plusieurs nodes
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: mariadb-operator
          topologyKey: kubernetes.io/hostname

# Webhooks
webhook:
  enabled: true
  port: 9443
  cert:
    certManager:
      enabled: true  # Utiliser cert-manager pour les certificats

# Metrics
metrics:
  enabled: true
  serviceMonitor:
    enabled: true  # Pour Prometheus Operator

# Logging
logLevel: info  # debug, info, warn, error

# CRDs
crds:
  # Installer automatiquement les CRDs
  install: true
  # Garder les CRDs lors de la d√©sinstallation
  keep: true

# RBAC
rbac:
  create: true

# ServiceAccount
serviceAccount:
  create: true
  name: mariadb-operator
```

```bash
# Installer avec configuration personnalis√©e
helm install mariadb-operator \
  mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --create-namespace \
  --values values-custom.yaml

# Mettre √† jour l'installation
helm upgrade mariadb-operator \
  mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --values values-custom.yaml
```

### M√©thode 2 : Installation avec manifests YAML

```bash
# T√©l√©charger les manifests
OPERATOR_VERSION="v0.28.0"
curl -sL https://github.com/mariadb-operator/mariadb-operator/releases/download/${OPERATOR_VERSION}/manifest.yaml > operator.yaml

# Installer les CRDs et l'operator
kubectl apply -f operator.yaml

# V√©rifier
kubectl get pods -n mariadb-system
kubectl wait --for=condition=ready pod \
  -l app.kubernetes.io/name=mariadb-operator \
  -n mariadb-system \
  --timeout=300s
```

### M√©thode 3 : Installation avec Kustomize

```yaml
# kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: mariadb-system

resources:
  - https://github.com/mariadb-operator/mariadb-operator/releases/download/v0.28.0/manifest.yaml

# Patches pour personnalisation
patches:
  - target:
      kind: Deployment
      name: mariadb-operator
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 3
      - op: add
        path: /spec/template/spec/containers/0/resources
        value:
          limits:
            cpu: 500m
            memory: 512Mi
          requests:
            cpu: 100m
            memory: 128Mi
```

```bash
# Appliquer avec Kustomize
kubectl apply -k .
```

---

## Custom Resource Definitions (CRDs)

### Vue d'ensemble des CRDs

Le MariaDB Operator fournit plusieurs CRDs pour g√©rer MariaDB et ses op√©rations :

| CRD | Description | Scope |
|-----|-------------|-------|
| **MariaDB** | Instance MariaDB (standalone ou r√©plication) | Namespaced |
| **MaxScale** | Proxy MariaDB MaxScale | Namespaced |
| **Backup** | Sauvegarde MariaDB | Namespaced |
| **Restore** | Restauration MariaDB | Namespaced |
| **User** | Utilisateur MariaDB | Namespaced |
| **Grant** | Privil√®ges MariaDB | Namespaced |
| **Database** | Base de donn√©es MariaDB | Namespaced |
| **Connection** | Informations de connexion | Namespaced |

```bash
# Lister toutes les CRDs MariaDB
kubectl get crd | grep mariadb

# Sortie attendue :
# backups.k8s.mariadb.com
# connections.k8s.mariadb.com
# databases.k8s.mariadb.com
# grants.k8s.mariadb.com
# mariadbs.k8s.mariadb.com
# maxscales.k8s.mariadb.com
# restores.k8s.mariadb.com
# users.k8s.mariadb.com
```

### CRD MariaDB (Principal)

#### Structure de la ressource

```yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb-instance
  namespace: mariadb-app
spec:
  # Version MariaDB
  image: mariadb:11.8.1  # üÜï MariaDB 11.8 LTS
  
  # Nombre de replicas (1 = standalone, >1 = replication)
  replicas: 1
  
  # Credentials (r√©f√©rence √† un Secret)
  rootPasswordSecretKeyRef:
    name: mariadb-root
    key: password
  
  # Configuration
  myCnf: |
    [mariadb]
    bind-address=*
    default_storage_engine=InnoDB
    character_set_server=utf8mb4
    collation_server=utf8mb4_unicode_ci
    
    # InnoDB
    innodb_buffer_pool_size=2G
    innodb_log_file_size=512M
    
    # üÜï MariaDB 11.8
    innodb_alter_copy_bulk=256M
    max_tmp_space_usage=10G
  
  # Storage
  storage:
    size: 10Gi
    storageClassName: standard
    accessModes:
      - ReadWriteOnce
  
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  # High Availability
  updateStrategy:
    type: RollingUpdate
  
  # Metrics
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
```

#### Champs importants

**spec.image** :
- Image Docker MariaDB √† utiliser
- Recommand√© : Toujours utiliser un tag versionn√© (`11.8.1`)
- üÜï MariaDB 11.8 LTS recommand√© pour production

**spec.replicas** :
- `1` : Instance standalone
- `>1` : R√©plication automatique Master-Slave
- Maximum recommand√© : 5 replicas

**spec.myCnf** :
- Configuration MariaDB au format my.cnf
- Overrides la configuration par d√©faut
- Support des variables d'environnement

**spec.storage** :
- `size` : Taille du volume persistant
- `storageClassName` : Classe de stockage √† utiliser
- `accessModes` : Modes d'acc√®s (RWO, ROX, RWX)

**spec.resources** :
- `requests` : Ressources minimales garanties
- `limits` : Ressources maximales autoris√©es
- Important pour le scheduling Kubernetes

### Inspecting CRDs

```bash
# Voir la d√©finition compl√®te d'une CRD
kubectl explain mariadb

# Voir les champs disponibles
kubectl explain mariadb.spec

# Voir un champ sp√©cifique
kubectl explain mariadb.spec.storage

# Obtenir la documentation d'un champ
kubectl explain mariadb.spec.replicas

# Voir les exemples dans la CRD
kubectl get crd mariadbs.k8s.mariadb.com -o yaml
```

---

## D√©ploiement de la premi√®re instance MariaDB

### 1. Cr√©er le Secret pour le mot de passe root

```yaml
# mariadb-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: mariadb-root
  namespace: mariadb-app
type: Opaque
stringData:
  password: "SuperSecureRootPassword123!"
```

```bash
kubectl apply -f mariadb-secret.yaml
```

üí° **Conseil** : En production, utilisez des outils comme Sealed Secrets, External Secrets Operator ou HashiCorp Vault.

### 2. Cr√©er la ressource MariaDB

```yaml
# mariadb-instance.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb-dev
  namespace: mariadb-app
  labels:
    app: mariadb
    environment: development
spec:
  # üÜï MariaDB 11.8 LTS
  image: mariadb:11.8.1
  imagePullPolicy: IfNotPresent
  
  # Standalone instance
  replicas: 1
  
  # Root password
  rootPasswordSecretKeyRef:
    name: mariadb-root
    key: password
  
  # Configuration MariaDB
  myCnf: |
    [mariadb]
    bind-address=*
    default_storage_engine=InnoDB
    
    # üÜï Character set (utf8mb4 par d√©faut en 11.8)
    character_set_server=utf8mb4
    collation_server=utf8mb4_unicode_ci
    
    # InnoDB Configuration
    innodb_buffer_pool_size=1G
    innodb_log_file_size=256M
    innodb_flush_log_at_trx_commit=2
    
    # üÜï MariaDB 11.8 optimizations
    innodb_alter_copy_bulk=128M
    max_tmp_space_usage=5G
    
    # Connections
    max_connections=200
    
    # Logging
    slow_query_log=1
    long_query_time=2
  
  # Storage
  storage:
    size: 20Gi
    storageClassName: standard
    accessModes:
      - ReadWriteOnce
  
  # Resources
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  
  # Ports
  port: 3306
  
  # Service
  service:
    type: ClusterIP
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-type: nlb
  
  # Metrics pour Prometheus
  metrics:
    enabled: true
    exporter:
      image: prom/mysqld-exporter:latest
      port: 9104
    serviceMonitor:
      enabled: true
      interval: 30s
      scrapeTimeout: 10s
  
  # Update Strategy
  updateStrategy:
    type: RollingUpdate
  
  # Pod Management Policy
  podManagementPolicy: OrderedReady
  
  # Affinity pour √©viter de placer sur le m√™me node
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: mariadb
                app.kubernetes.io/instance: mariadb-dev
            topologyKey: kubernetes.io/hostname
```

```bash
# Appliquer la ressource
kubectl apply -f mariadb-instance.yaml

# V√©rifier le d√©ploiement
kubectl get mariadb -n mariadb-app
kubectl get pods -n mariadb-app
kubectl get pvc -n mariadb-app
kubectl get svc -n mariadb-app
```

### 3. V√©rifier le status

```bash
# Status de la ressource MariaDB
kubectl get mariadb mariadb-dev -n mariadb-app -o yaml

# Voir les √©v√©nements
kubectl describe mariadb mariadb-dev -n mariadb-app

# Logs de l'operator
kubectl logs -n mariadb-system deployment/mariadb-operator -f

# Logs du pod MariaDB
kubectl logs -n mariadb-app mariadb-dev-0 -f

# Status d√©taill√©
kubectl get mariadb mariadb-dev -n mariadb-app -o jsonpath='{.status.conditions}' | jq
```

### 4. Se connecter √† MariaDB

```bash
# Port-forward pour acc√®s local
kubectl port-forward -n mariadb-app svc/mariadb-dev 3306:3306

# Dans un autre terminal
mariadb -h 127.0.0.1 -P 3306 -uroot -p

# Ou depuis un pod dans le cluster
kubectl run -it --rm mariadb-client \
  --image=mariadb:11.8 \
  --restart=Never \
  -n mariadb-app \
  -- mariadb -h mariadb-dev -uroot -p
```

---

## CRD Database

Cr√©er des bases de donn√©es de mani√®re d√©clarative :

```yaml
# database.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: Database
metadata:
  name: app-database
  namespace: mariadb-app
spec:
  # Instance MariaDB cible
  mariaDbRef:
    name: mariadb-dev
  
  # Nom de la base
  name: myapp_production
  
  # Character set
  characterSet: utf8mb4
  collate: utf8mb4_unicode_ci
  
  # Retry
  retryInterval: 5s
```

```bash
kubectl apply -f database.yaml
kubectl get database -n mariadb-app
```

---

## CRD User

Cr√©er des utilisateurs de mani√®re d√©clarative :

```yaml
# user-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-user-password
  namespace: mariadb-app
type: Opaque
stringData:
  password: "AppUserSecurePassword123!"
---
# user.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: User
metadata:
  name: app-user
  namespace: mariadb-app
spec:
  # Instance MariaDB
  mariaDbRef:
    name: mariadb-dev
  
  # Nom d'utilisateur
  name: appuser
  
  # Mot de passe (r√©f√©rence au Secret)
  passwordSecretKeyRef:
    name: app-user-password
    key: password
  
  # Host autoris√©
  host: "%"
  
  # Max connexions
  maxUserConnections: 100
  
  # Retry
  retryInterval: 5s
```

```bash
kubectl apply -f user-secret.yaml
kubectl apply -f user.yaml
kubectl get user -n mariadb-app
```

---

## CRD Grant

Attribuer des privil√®ges de mani√®re d√©clarative :

```yaml
# grant.yaml
apiVersion: k8s.mariadb.com/v1alpha1
kind: Grant
metadata:
  name: app-user-grant
  namespace: mariadb-app
spec:
  # Instance MariaDB
  mariaDbRef:
    name: mariadb-dev
  
  # Privil√®ges
  privileges:
    - "SELECT"
    - "INSERT"
    - "UPDATE"
    - "DELETE"
    - "CREATE"
    - "DROP"
    - "INDEX"
    - "ALTER"
  
  # Base de donn√©es
  database: "myapp_production"
  
  # Table (* = toutes)
  table: "*"
  
  # Utilisateur
  username: appuser
  
  # Host
  host: "%"
  
  # Grant option
  grantOption: false
  
  # Retry
  retryInterval: 5s
```

```bash
kubectl apply -f grant.yaml
kubectl get grant -n mariadb-app
```

---

## RBAC Configuration

### ServiceAccount pour l'operator

```yaml
# serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: mariadb-operator
  namespace: mariadb-system
---
# clusterrole.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: mariadb-operator
rules:
  # Permissions sur les CRDs MariaDB
  - apiGroups:
      - k8s.mariadb.com
    resources:
      - mariadbs
      - mariadbs/status
      - mariadbs/finalizers
      - backups
      - backups/status
      - backups/finalizers
      - restores
      - restores/status
      - restores/finalizers
      - users
      - users/status
      - users/finalizers
      - grants
      - grants/status
      - grants/finalizers
      - databases
      - databases/status
      - databases/finalizers
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  
  # Permissions sur les ressources Kubernetes
  - apiGroups:
      - ""
    resources:
      - pods
      - services
      - endpoints
      - persistentvolumeclaims
      - events
      - configmaps
      - secrets
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  
  - apiGroups:
      - apps
    resources:
      - statefulsets
      - deployments
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  
  - apiGroups:
      - batch
    resources:
      - jobs
      - cronjobs
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  
  - apiGroups:
      - monitoring.coreos.com
    resources:
      - servicemonitors
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
---
# clusterrolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: mariadb-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: mariadb-operator
subjects:
  - kind: ServiceAccount
    name: mariadb-operator
    namespace: mariadb-system
```

### RBAC pour les applications

```yaml
# app-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: mariadb-app
  namespace: mariadb-app
---
# app-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: mariadb-user
  namespace: mariadb-app
rules:
  - apiGroups:
      - k8s.mariadb.com
    resources:
      - mariadbs
      - databases
      - users
      - grants
    verbs:
      - get
      - list
      - watch
  
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - get
      - list
---
# app-rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: mariadb-user
  namespace: mariadb-app
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: mariadb-user
subjects:
  - kind: ServiceAccount
    name: mariadb-app
    namespace: mariadb-app
```

---

## Webhooks de validation et mutation

### Webhook de validation

Le webhook valide les ressources avant leur cr√©ation/modification :

```yaml
# Exemple de validation automatique
apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: invalid-mariadb
spec:
  image: mariadb:11.8
  replicas: -1  # ‚ùå Invalide : replicas doit √™tre > 0
  storage:
    size: 0Gi   # ‚ùå Invalide : size doit √™tre > 0
```

```bash
# Tentative d'application
kubectl apply -f invalid-mariadb.yaml

# Erreur attendue :
# Error from server (Forbidden): error when creating "invalid-mariadb.yaml":
# admission webhook "vmariadb.kb.io" denied the request:
# spec.replicas: Invalid value: -1: must be greater than 0
```

### Webhook de mutation

Le webhook modifie automatiquement les ressources :

```yaml
# Les valeurs par d√©faut sont automatiquement ajout√©es
apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb-minimal
spec:
  image: mariadb:11.8
  rootPasswordSecretKeyRef:
    name: mariadb-root
    key: password
  # storage non sp√©cifi√© ‚Üí valeurs par d√©faut ajout√©es par le webhook
```

Apr√®s mutation automatique :

```yaml
spec:
  image: mariadb:11.8
  rootPasswordSecretKeyRef:
    name: mariadb-root
    key: password
  storage:
    size: 10Gi  # ‚úÖ Ajout√© par d√©faut
    storageClassName: standard  # ‚úÖ Ajout√© par d√©faut
    accessModes:
      - ReadWriteOnce  # ‚úÖ Ajout√© par d√©faut
```

---

## Troubleshooting

### Diagnostic de l'operator

```bash
# V√©rifier que l'operator est running
kubectl get pods -n mariadb-system
kubectl logs -n mariadb-system deployment/mariadb-operator -f

# V√©rifier les webhooks
kubectl get validatingwebhookconfigurations
kubectl get mutatingwebhookconfigurations

# V√©rifier les CRDs
kubectl get crd | grep mariadb
kubectl describe crd mariadbs.k8s.mariadb.com
```

### Diagnostic d'une instance MariaDB

```bash
# Status de la ressource
kubectl get mariadb mariadb-dev -n mariadb-app -o yaml

# √âv√©nements
kubectl get events -n mariadb-app --sort-by='.lastTimestamp'

# Describe
kubectl describe mariadb mariadb-dev -n mariadb-app

# Logs du StatefulSet
kubectl logs -n mariadb-app mariadb-dev-0

# Shell dans le pod
kubectl exec -it -n mariadb-app mariadb-dev-0 -- bash
```

### Probl√®mes courants

#### 1. Pod bloqu√© en Pending

```bash
# V√©rifier les √©v√©nements
kubectl describe pod mariadb-dev-0 -n mariadb-app

# Causes communes :
# - Pas de PVC disponible
# - Ressources insuffisantes
# - Node selector ne matche aucun node
# - StorageClass inexistante

# Solutions :
kubectl get pvc -n mariadb-app
kubectl describe pvc -n mariadb-app
kubectl get storageclass
```

#### 2. Webhook timeout

```bash
# V√©rifier le service webhook
kubectl get svc -n mariadb-system

# V√©rifier les endpoints
kubectl get endpoints -n mariadb-system

# Logs du webhook
kubectl logs -n mariadb-system deployment/mariadb-operator | grep webhook

# Solution temporaire : d√©sactiver les webhooks
helm upgrade mariadb-operator mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --set webhook.enabled=false
```

#### 3. Erreur de r√©conciliation

```bash
# Logs d√©taill√©s de l'operator
kubectl logs -n mariadb-system deployment/mariadb-operator --tail=100

# V√©rifier le status de la ressource
kubectl get mariadb mariadb-dev -n mariadb-app -o jsonpath='{.status}'

# Forcer la r√©conciliation (ajouter une annotation)
kubectl annotate mariadb mariadb-dev -n mariadb-app \
  reconcile.mariadb.com/timestamp="$(date +%s)"
```

---

## Monitoring de l'operator

### M√©triques Prometheus

L'operator expose des m√©triques au format Prometheus :

```yaml
# servicemonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: mariadb-operator
  namespace: mariadb-system
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: mariadb-operator
  endpoints:
    - port: metrics
      interval: 30s
      path: /metrics
```

**M√©triques cl√©s** :
- `mariadb_operator_reconcile_total` : Nombre de r√©conciliations
- `mariadb_operator_reconcile_errors_total` : Erreurs de r√©conciliation
- `mariadb_operator_reconcile_duration_seconds` : Dur√©e des r√©conciliations
- `mariadb_ready_replicas` : Nombre de replicas ready
- `mariadb_current_replicas` : Nombre de replicas actuels

### Dashboard Grafana

```json
{
  "title": "MariaDB Operator",
  "panels": [
    {
      "title": "Reconciliation Rate",
      "targets": [
        {
          "expr": "rate(mariadb_operator_reconcile_total[5m])"
        }
      ]
    },
    {
      "title": "Error Rate",
      "targets": [
        {
          "expr": "rate(mariadb_operator_reconcile_errors_total[5m])"
        }
      ]
    },
    {
      "title": "Ready Replicas",
      "targets": [
        {
          "expr": "mariadb_ready_replicas"
        }
      ]
    }
  ]
}
```

---

## Mise √† jour de l'operator

### Upgrade avec Helm

```bash
# Voir les nouvelles versions disponibles
helm search repo mariadb-operator/mariadb-operator --versions

# Voir les changements
helm diff upgrade mariadb-operator \
  mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --version 0.29.0

# Upgrade
helm upgrade mariadb-operator \
  mariadb-operator/mariadb-operator \
  --namespace mariadb-system \
  --version 0.29.0

# V√©rifier
kubectl get pods -n mariadb-system
kubectl rollout status deployment/mariadb-operator -n mariadb-system
```

### Rollback en cas de probl√®me

```bash
# Voir l'historique
helm history mariadb-operator -n mariadb-system

# Rollback √† la version pr√©c√©dente
helm rollback mariadb-operator -n mariadb-system

# Rollback √† une version sp√©cifique
helm rollback mariadb-operator 1 -n mariadb-system
```

---

## Bonnes pratiques

### 1. Utiliser des namespaces s√©par√©s

```bash
# Operator dans son namespace
kubectl create namespace mariadb-system

# Applications dans leurs namespaces
kubectl create namespace app-prod
kubectl create namespace app-staging
kubectl create namespace app-dev
```

### 2. Versionner les manifests

```bash
# Structure GitOps
mariadb-k8s/
‚îú‚îÄ‚îÄ base/
‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml
‚îÇ   ‚îî‚îÄ‚îÄ mariadb.yaml
‚îú‚îÄ‚îÄ overlays/
‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kustomization.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ patches.yaml
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îî‚îÄ‚îÄ README.md
```

### 3. Utiliser des labels et annotations

```yaml
metadata:
  labels:
    app: mariadb
    environment: production
    tier: database
    managed-by: mariadb-operator
  annotations:
    description: "Production MariaDB for MyApp"
    owner: "platform-team@example.com"
    version: "11.8.1"
```

### 4. Configurer les resource limits

```yaml
spec:
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi
```

### 5. Activer le monitoring

```yaml
spec:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 30s
```

---

## ‚úÖ Points cl√©s √† retenir

- **Operator Pattern** : Extension Kubernetes avec CRDs et controller pour g√©rer MariaDB
- **CRDs** : 8 ressources principales (MariaDB, User, Grant, Database, Backup, etc.)
- **Installation** : Helm recommand√©, supporte aussi manifests YAML et Kustomize
- **Webhooks** : Validation et mutation automatiques des ressources
- **RBAC** : Configuration fine des permissions n√©cessaire
- **Monitoring** : M√©triques Prometheus int√©gr√©es pour observabilit√©
- **GitOps ready** : Manifests d√©claratifs versionnables
- **Production** : Namespaces s√©par√©s, resource limits, monitoring activ√©
- **Troubleshooting** : Logs operator + events + describe pour diagnostic
- **MariaDB 11.8** : Support natif avec optimisations (utf8mb4, Vector, etc.)

---

## üîó Ressources et r√©f√©rences

### Documentation officielle
- [üìñ MariaDB Operator Documentation](https://github.com/mariadb-operator/mariadb-operator)
- [üìñ CRD Reference](https://github.com/mariadb-operator/mariadb-operator/blob/main/docs/API_REFERENCE.md)
- [üìñ Kubernetes Operators](https://kubernetes.io/docs/concepts/extend-kubernetes/operator/)
- [üìñ Custom Resource Definitions](https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/)

### Repository et exemples
- [GitHub - MariaDB Operator](https://github.com/mariadb-operator/mariadb-operator)
- [Helm Chart](https://github.com/mariadb-operator/mariadb-operator/tree/main/deploy/charts/mariadb-operator)
- [Examples](https://github.com/mariadb-operator/mariadb-operator/tree/main/examples)

### Community
- [Slack](https://r.mariadb.com/join-community-slack)
- [GitHub Discussions](https://github.com/mariadb-operator/mariadb-operator/discussions)

---

## ‚û°Ô∏è Section suivante

**16.5.2 D√©ploiement Galera avec operator** : D√©couvrez comment d√©ployer un cluster Galera haute disponibilit√© avec le MariaDB Operator, incluant la configuration multi-master et le self-healing.

---

**MariaDB** : 11.8 LTS  
**MariaDB Operator** : 0.28.0

‚è≠Ô∏è [D√©ploiement Galera avec operator](/16-devops-automatisation/05.2-deploiement-galera.md)
